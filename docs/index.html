<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>game_experiments</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const T=1e-9,m=e=>`${e[0]},${e[1]},${e[2]}`,U=e=>{const t=e.split(",");if(t.length!==3)throw new Error(`Invalid CubeKey: "${e}"`);const o=Number(t[0]),s=Number(t[1]),n=Number(t[2]);return[o,s,n]},lt=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],bt=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],xt=(e,t)=>[e[0]*t,e[1]*t,e[2]*t],It=e=>(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]))/2,Ct=(e,t)=>It(bt(e,t)),V=[[1,-1,0],[1,0,-1],[0,1,-1],[-1,1,0],[-1,0,1],[0,-1,1]],yt=e=>{const t=(e%6+6)%6;return V[t]},kt=(e,t)=>lt(e,yt(t)),Et=e=>[e[0],e[2]],wt=(e,t)=>{const o=[];for(let s=-t;s<=t;s++)for(let n=Math.max(-t,-s-t);n<=Math.min(t,-s+t);n++){const i=-s-n;o.push(lt(e,[s,n,i]))}return o},Tt=(e,t)=>{if(t<0)return[];if(t===0)return[e];let o=lt(e,xt(yt(4),t));const s=[];for(let n=0;n<6;n++)for(let i=0;i<t;i++)s.push(o),o=kt(o,n);return s},ht=(e,t=[0,0,0])=>wt(t,e),W=(e,t)=>{const[o,s]=Et(e),{size:n,origin:i,orientation:r}=t;if(r==="pointy"){const l=n.x*(Math.sqrt(3)*o+Math.sqrt(3)/2*s),c=n.y*(3/2*s);return{x:l+i.x,y:c+i.y}}else{const l=n.x*(1.5*o),c=n.y*(Math.sqrt(3)/2*o+Math.sqrt(3)*s);return{x:l+i.x,y:c+i.y}}};function G(e,t,o){return(t.x-e.x)*(o.y-e.y)-(t.y-e.y)*(o.x-e.x)}function Y(e,t,o){return Math.min(e.x,t.x)-T<=o.x&&o.x<=Math.max(e.x,t.x)+T&&Math.min(e.y,t.y)-T<=o.y&&o.y<=Math.max(e.y,t.y)+T&&Math.abs(G(e,t,o))<=T}function St(e,t,o,s){const n=G(e,t,o),i=G(e,t,s),r=G(o,s,e),l=G(o,s,t);return!!((n>T&&i<-T||n<-T&&i>T)&&(r>T&&l<-T||r<-T&&l>T)||Math.abs(n)<=T&&Y(e,t,o)||Math.abs(i)<=T&&Y(e,t,s)||Math.abs(r)<=T&&Y(o,s,e)||Math.abs(l)<=T&&Y(o,s,t))}function Mt(e,t){let o=0;for(let s=0;s<t.length;s++){const n=t[s],i=t[(s+1)%t.length],r=G(n,i,e);if(Math.abs(r)<=T)continue;const l=r>0?1:-1;if(o===0)o=l;else if(o!==l)return!1}return!0}function Lt(e,t,o){for(let n=0;n<o.length;n++){const i=o[n],r=o[(n+1)%o.length];if(St(e,t,i,r))return!0}const s={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!Mt(s,o)}function nt(e,t){const o=W(e,t),s=t.size?.x??t.size?.X,n=t.size?.y??t.size?.Y,i=t.orientation?.startAngle??0;if(typeof s!="number"||typeof n!="number")throw new Error("hexCorners: layout.size.x/y not found; use your hexlib corner helper instead.");const r=[];for(let l=0;l<6;l++){const c=2*Math.PI*(i+l)/6;r.push({x:o.x+s*Math.cos(c),y:o.y+n*Math.sin(c)})}return r}function $t(e,t,o,s,n){const i=nt(e,o),r=nt(t,o),l=[];for(const c of n){const p=U(c);if(!s(p))continue;const u=nt(p,o),y=W(p,o),v=u.map(I=>({x:y.x+(I.x-y.x)*1.1,y:y.y+(I.y-y.y)*1.1}));l.push(v)}for(const c of i)for(const p of r){let u=!1;for(const y of l)if(Lt(c,p,y)){u=!0;break}if(!u)return Ct(e,t)}return NaN}const Rt={size:{x:1,y:1},origin:{x:0,y:0},orientation:"pointy"},Pt=.05,At=.05,Nt=.05;function zt(e){const t={...e,entities:new Map(e.entities),E:new Map(e.E),capacitors:new Map,reservoirs:new Map,totalEnergyCollected:new Map(e.totalEnergyCollected),lastTickEnergy:new Map,lastCapacitorDelta:new Map,lastDeltaE:new Map,lastPerimeterEnergy:0,tickCount:e.tickCount+1};for(const[d,a]of e.capacitors)t.capacitors.set(d,{...a});for(const[d,a]of e.reservoirs)t.reservoirs.set(d,{...a,radiator:{...a.radiator}});const{diffusionAlpha:o,baseConductivity:s}=e,n=[],i=[],r=[],l=[];for(const d of e.entities.values())d.type==="source"?n.push(d):d.type==="sink"?i.push(d):d.type==="shield"?r.push(d):d.type==="probe"&&l.push(d);const c=new Set;for(const d of r){if(d.destroyed)continue;const a=m(d.pos),h=e.E.get(a)??0,C=d.heatTolerance??2e3;if(h>C&&Math.random()<Pt){const w={...d,destroyed:!0};t.entities.set(a,w),c.add(a)}}const p=new Set;for(const d of i){if(d.destroyed)continue;const a=m(d.pos),h=e.E.get(a)??0,C=d.heatTolerance??1400;if(h>C&&Math.random()<At){const w={...d,destroyed:!0};t.entities.set(a,w),p.add(a)}}for(const d of l){if(d.destroyed)continue;const a=m(d.pos),h=e.E.get(a)??0,C=d.heatTolerance??1800;if(h>C&&Math.random()<Nt){const w={...d,destroyed:!0};t.entities.set(a,w)}}const u=new Set;for(const d of r){const a=m(d.pos);if(c.has(a)||d.destroyed)continue;d.groupId!==void 0&&e.disabledShieldGroups.has(d.groupId)||u.add(a)}const y=d=>u.has(m(d)),v=new Set;for(const d of l){const a=m(d.pos);if(t.entities.get(a)?.destroyed){v.add(a);continue}if(d.destroyed){v.add(a);continue}let C=!1;for(const w of n){if(!w.active)continue;const N=$t(d.pos,w.pos,Rt,y,u);if(!Number.isNaN(N)){C=!0;break}}if(C){const w=m(d.pos);t.entities.set(w,{...d,destroyed:!0}),v.add(w)}}const I=new Map;for(const[d,a]of t.capacitors)I.set(d,a.stored);const b=new Map;for(const[d,a]of e.probeThrottles)b.set(d,a);for(const[d,a]of t.capacitors)a.stored>=a.capacity&&b.set(d,0),a.stored=Math.max(0,a.stored-a.drainRate),a.stored>a.capacity&&(a.stored=a.capacity);for(const d of i){const a=t.reservoirs.get(d.groupId);if(a){const h=Math.max(1,a.volume),C=a.heat/h,w=m(d.pos);t.E.set(w,C)}}const g=new Map;for(const d of t.E.keys())g.set(d,s);for(const d of r){if(d.groupId!==void 0&&e.disabledShieldGroups.has(d.groupId))continue;const a=m(d.pos);if(!t.E.has(a))continue;const h=g.get(a)??s;g.set(a,Math.min(h,ut(d.conductivity)))}for(const d of i){const a=m(d.pos);if(!t.E.has(a))continue;const h=g.get(a)??s;g.set(a,Math.min(h,ut(d.conductivity)))}const f=new Map;for(const d of n){if(!d.active)continue;const a=m(d.pos);if(!t.E.has(a))continue;let h=1;d.groupId!==void 0&&(h=e.groupThrottles.get(d.groupId)??1);const C=d.power*h;t.E.set(a,(t.E.get(a)??0)+C),f.set(a,(f.get(a)??0)+C)}const x=new Map;for(const d of t.E.keys())x.set(d,0);const et=[V[0],V[1],V[2]];for(const d of t.E.keys()){const a=U(d),h=t.E.get(d)??0,C=g.get(d)??s;for(const[w,N,H]of et){const z=[a[0]+w,a[1]+N,a[2]+H],P=m(z);if(!t.E.has(P))continue;const O=t.E.get(P)??0,D=g.get(P)??s,F=Math.min(C,D)*o*(h-O);x.set(d,(x.get(d)??0)-F),x.set(P,(x.get(P)??0)+F)}}const B=new Set;for(const d of i)B.add(m(d.pos));for(const d of i){const a=m(d.pos),h=t.reservoirs.get(d.groupId);if(h){const C=f.get(a)??0,w=x.get(a)??0,N=C+w;h.heat+=N}}for(const d of t.reservoirs.values())if(d.radiator.deployed){const a=Math.min(d.heat,d.radiator.strength);d.heat-=a}for(const[d,a]of x.entries())B.has(d)||t.E.set(d,(t.E.get(d)??0)+a);for(const d of i){const a=t.reservoirs.get(d.groupId);if(a){const h=m(d.pos),C=Math.max(1,a.volume);t.E.set(h,a.heat/C)}}const M=new Map,j=.9,at=.3,_=new Map;for(const d of l){const a=m(d.pos);if(v.has(a))continue;const h=d.groupId??1;_.has(h)||_.set(h,[]),_.get(h).push(m(d.pos))}for(const[d,a]of _.entries()){const h=b.get(d)??0;if(h<=0)continue;let C=1/0;if(t.capacitors.has(d)){const S=t.capacitors.get(d),A=S.capacity-S.stored;if(A<=0)continue;C=A}let w=0,N=0;const H=new Map;for(const S of a){if(!t.E.has(S))continue;const A=t.E.get(S)??0;H.set(S,A),w+=A,N++}if(N<2)continue;const z=w/N;let P=0,O=0;for(const S of H.values())S>z?P+=S-z:O+=z-S;if(P<1e-4)continue;let D=P*h*j;const ot=C/at;D>ot&&(D=ot);const F=D*at,mt=D-F;for(const[S,A]of H.entries()){let st=0;if(A>z){const it=(A-z)/P;st=-1*D*it}else if(A<z&&O>0){const it=(z-A)/O;st=mt*it}t.E.set(S,(t.E.get(S)??0)+st)}if(M.set(d,F),t.capacitors.has(d)){const S=t.capacitors.get(d);S.stored=Math.min(S.capacity,S.stored+F)}}for(const[d,a]of t.E.entries()){const h=Math.abs(a)<1e-12?0:a,C=e.E.get(d)??0;t.lastDeltaE.set(d,h-C),t.E.set(d,h)}for(const[d,a]of t.capacitors){const h=I.get(d)??a.stored;t.lastCapacitorDelta.set(d,a.stored-h)}t.lastTickEnergy=M;for(const[d,a]of M){const h=t.totalEnergyCollected.get(d)??0;t.totalEnergyCollected.set(d,h+a)}let pt=0;const vt=Tt([0,0,0],e.radius);for(const d of vt){const a=m(d);pt+=t.E.get(a)??0}return t.lastPerimeterEnergy=pt,{energyCollected:M,nextState:t}}function ut(e){return e<0?0:e}class Bt{state;constructor(t,o=8){if(this.state={entities:new Map,E:new Map,capacitors:new Map,reservoirs:new Map,groupThrottles:new Map,probeThrottles:new Map,disabledShieldGroups:new Set,totalEnergyCollected:new Map,lastTickEnergy:new Map,lastCapacitorDelta:new Map,lastDeltaE:new Map,lastPerimeterEnergy:0,tickCount:0,radius:o,diffusionAlpha:.1,baseConductivity:1},t)for(const s of t)this.state.E.set(s,0);for(const s of[1,2,3,4])this.state.groupThrottles.set(s,1),this.state.probeThrottles.set(s,0),this.state.totalEnergyCollected.set(s,0),this.state.capacitors.set(s,{id:s,stored:0,capacity:1e3,drainRate:1,surchargeCost:500});for(const s of[1,2,3,4,5,6])this.state.reservoirs.set(s,{id:s,heat:0,volume:5e3,radiator:{deployed:!1,strength:50}})}tick(){const t=zt(this.state);this.state=t.nextState}dischargeBank(t){const o=this.state.capacitors.get(t);return o&&o.stored>=o.surchargeCost?(o.stored-=o.surchargeCost,!0):!1}toggleShieldGroup(t){if(this.state.disabledShieldGroups.has(t)){this.state.disabledShieldGroups.delete(t);for(const[o,s]of this.state.entities)s.type==="shield"&&s.groupId===t&&s.retainedE!==void 0&&(this.state.E.set(o,s.retainedE),s.retainedE=void 0)}else{this.state.disabledShieldGroups.add(t);for(const[o,s]of this.state.entities)s.type==="shield"&&s.groupId===t&&(s.retainedE=this.state.E.get(o)||0,this.state.E.set(o,0))}}setEntity(t,o){const s=U(t);if(o==="empty"){this.state.entities.delete(t);return}let n;switch(o){case"source":n={type:"source",pos:s,power:10,active:!0,minActivation:0,groupId:1};break;case"sink":n={type:"sink",pos:s,pullRate:.1,conductivity:.8,groupId:1,heatTolerance:1400};break;case"shield":n={type:"shield",pos:s,conductivity:1e-4,groupId:1,heatTolerance:2e3};break;case"probe":n={type:"probe",pos:s,groupId:1,heatTolerance:1800};break}this.state.entities.set(t,n)}serialize(){return JSON.stringify({entities:Array.from(this.state.entities.entries()),capacitors:Array.from(this.state.capacitors.entries()),reservoirs:Array.from(this.state.reservoirs.entries()),groupThrottles:Array.from(this.state.groupThrottles.entries()),probeThrottles:Array.from(this.state.probeThrottles.entries()),disabledShieldGroups:Array.from(this.state.disabledShieldGroups)})}deserialize(t){try{const o=JSON.parse(t);if(this.state.entities.clear(),o.entities)for(const[s,n]of o.entities)n.type==="sink"&&n.groupId===void 0&&(n.groupId=1,console.log("Migrated legacy sink to Group 1")),n.type==="sink"&&"stored"in n&&(delete n.stored,delete n.capacityScale,delete n.dumpMax),this.state.entities.set(s,n);if(o.capacitors){this.state.capacitors.clear();for(const[s,n]of o.capacitors)this.state.capacitors.set(s,n)}if(o.reservoirs){this.state.reservoirs.clear();for(const[s,n]of o.reservoirs)this.state.reservoirs.set(s,{...n,radiator:n.radiator||{deployed:!1,strength:50}})}else for(const s of[1,2,3,4,5,6])this.state.reservoirs.has(s)||this.state.reservoirs.set(s,{id:s,heat:0,volume:5e3,radiator:{deployed:!1,strength:50}});if(o.groupThrottles){this.state.groupThrottles.clear();for(const[s,n]of o.groupThrottles)this.state.groupThrottles.set(s,n)}else for(const s of[1,2,3,4])this.state.groupThrottles.set(s,1);if(o.probeThrottles){this.state.probeThrottles.clear();for(const[s,n]of o.probeThrottles)this.state.probeThrottles.set(s,n)}else for(const s of[1,2,3,4])this.state.probeThrottles.set(s,0);if(o.disabledShieldGroups){this.state.disabledShieldGroups.clear();for(const s of o.disabledShieldGroups)this.state.disabledShieldGroups.add(s)}else this.state.disabledShieldGroups.clear();for(const s of this.state.E.keys())this.state.E.set(s,0)}catch(o){console.error("Failed to load layout",o)}}clear(){this.state.entities.clear(),this.state.E.clear();const t=this.state.radius||8,o=ht(t);for(const s of o)this.state.E.set(m(s),0);this.state.capacitors.clear();for(const s of[1,2,3,4])this.state.totalEnergyCollected.set(s,0),this.state.capacitors.set(s,{id:s,stored:0,capacity:1e3,drainRate:1,surchargeCost:500});this.state.reservoirs.clear();for(const s of[1,2,3,4,5,6])this.state.reservoirs.set(s,{id:s,heat:0,volume:5e3,radiator:{deployed:!1,strength:50}});this.state.groupThrottles.clear(),this.state.probeThrottles.clear();for(const s of[1,2,3,4])this.state.groupThrottles.set(s,1),this.state.probeThrottles.set(s,0);this.state.disabledShieldGroups.clear(),this.state.tickCount=0,this.state.lastPerimeterEnergy=0,this.state.lastTickEnergy.clear(),this.state.lastCapacitorDelta.clear(),this.state.lastDeltaE.clear()}}function Dt(e){const t=new Map;for(const[o,s]of e.state.E.entries()){const n=e.state.entities.get(o),i=new Set;let r=s;if(n){if(i.add(n.type),n.destroyed&&i.add("destroyed"),n.type==="shield"){let c=n.groupId||0;e.state.disabledShieldGroups.has(c)&&i.add("disabled")}n.type==="source"?(n.active&&i.add("active"),r="S"):n.type==="sink"?r="X":n.type==="shield"?r="||":n.type==="probe"&&(r=s)}t.set(o,{value:r,tags:i,data:{temp:s,ent:n}})}return t}function Ft(e){const t=e.data?.temp||0,o={};return o.backgroundColor=Gt(t),e.tags.has("source")?(o.className="source-cell",o.color="black",e.tags.has("active")?o.text="ðŸ”†"+((e.data?.ent?.groupId||0)>0?e.data?.ent?.groupId:""):o.text="â­•"):e.tags.has("sink")?e.tags.has("destroyed")?(o.className="sink-cell-destroyed",o.text="ðŸ’¥",o.color="white"):(o.className="sink-cell",o.color="white",o.text="ðŸ•³ï¸"+((e.data?.ent?.groupId||0)>0?e.data?.ent?.groupId:"")):e.tags.has("shield")?(e.tags.has("destroyed")?(o.className="shield-cell-destroyed",o.text="ðŸ•¸",o.color="#a55"):e.tags.has("disabled")?(o.className="disabled-shield-cell",o.color="gray"):(o.className="shield-cell",o.color="black"),o.text="â›Š"+((e.data?.ent?.groupId||0)>0?e.data?.ent?.groupId:"")):e.tags.has("probe")?e.tags.has("destroyed")?(o.className="probe-cell-destroyed",o.text="â˜ ï¸",o.color="#555"):(o.className="probe-cell",o.text="âš¡"+((e.data?.ent?.groupId||0)>0?e.data?.ent?.groupId:"")):(o.className="monitor-cell",o.color=Ht(t)),o}function Gt(e){return`hsl(${(1-Math.min(Math.max(e/1450,0),1))*240}, 70%, 60%)`}function Ht(e){const s=(1-Math.min(Math.max(e/1450,0),1))*240,n=.7,i=.6,[r,l,c]=Ot(s/360,n,i);return .299*r+.587*l+.114*c>.5?"black":"white"}function Ot(e,t,o){let s,n,i;{const r=(p,u,y)=>(y<0&&(y+=1),y>1&&(y-=1),y<.16666666666666666?p+(u-p)*6*y:y<.5?u:y<.6666666666666666?p+(u-p)*(.6666666666666666-y)*6:p),l=o+t-o*t,c=2*o-l;s=r(c,l,e+1/3),n=r(c,l,e),i=r(c,l,e-1/3)}return[s,n,i]}const Kt={[-12]:"p",[-9]:"n",[-6]:"Âµ",[-3]:"m",0:"",3:"k",6:"M",9:"G",12:"T"};function Ut(e,t,o){return Math.max(t,Math.min(o,e))}function jt(e,t=3){const o=String(e);if(typeof e!="number"||!Number.isFinite(e))return o.length<=t?o:o.slice(0,t);const s=e<0?"-":"",n=Math.abs(e);let i=0;n>0&&(i=Math.floor(Math.log10(n)/3)*3,i=Ut(i,-12,12));const r=Kt[i]??"",l=n/Math.pow(10,i),c=r.length,p=t-s.length-c;if(p<=0)return(s+r).padEnd(1,"?").slice(0,t);const u=Math.floor(l),v=String(u).length;if(v>p){const f=Math.round(l),x=String(f);return x.length<=p?s+x+r:(s+x).slice(0,p)+r}const I=p-v-1;let b;I>0?(b=l.toFixed(I),b.length>p&&(b=l.toFixed(0))):b=l.toFixed(0);let g=s+b+r;if(g.length>t){if(g.includes(".")){const[f]=b.split(".");g=s+f+r}g.length>t&&(g=g.slice(0,t))}return g}class _t{container;layout;cellCache=new Map;onCellClick=null;onCellMouseDown=null;onCellMouseEnter=null;onCellHover=null;onCellRightClick=null;constructor(t,o){this.container=t,this.layout=o,this.container.style.position="relative"}updateLayout(t){this.layout=t}render(t,o={}){const s=new Set;for(const[n,i]of t.entries()){if(typeof n!="string"){console.error("Invalid key type:",typeof n,n);continue}s.add(n);let r=this.cellCache.get(n),l;if(r)l=r.firstElementChild;else{const u=U(n),y=W(u,this.layout);r=document.createElement("div"),r.className="hex",r.style.left=`${y.x}px`,r.style.top=`${y.y}px`,l=document.createElement("div"),l.className="hex-inner",r.appendChild(l),r.addEventListener("click",()=>{this.onCellClick&&this.onCellClick(u)}),r.addEventListener("mousedown",v=>{v.buttons===1&&this.onCellMouseDown&&this.onCellMouseDown(u)}),r.addEventListener("mouseenter",v=>{v.buttons===1&&this.onCellMouseEnter&&this.onCellMouseEnter(u),this.onCellHover&&this.onCellHover(u)}),r.addEventListener("contextmenu",v=>{v.preventDefault(),this.onCellRightClick&&this.onCellRightClick(u)}),this.container.appendChild(r),this.cellCache.set(n,r)}const c=U(n),p=W(c,this.layout);if(r.style.left=`${p.x}px`,r.style.top=`${p.y}px`,i.value){let u=jt(i.value,5);l.innerText!==u&&(l.innerText=u)}else l.innerText!==""&&(l.innerText="");if(o.styleFn){const u=o.styleFn(i,n);r.className="hex",u.className&&r.classList.add(u.className),u.backgroundColor?l.style.backgroundColor=u.backgroundColor:l.style.removeProperty("background-color"),u.color?l.style.color=u.color:l.style.removeProperty("color"),u.text!==void 0&&(l.innerText=u.text)}}for(const n of this.cellCache.keys())if(!s.has(n)){const i=this.cellCache.get(n);i&&i.remove(),this.cellCache.delete(n)}}}const Yt=JSON.parse('[["-8,8,0",{"type":"shield","pos":[-8,8,0],"conductivity":0.0001,"groupId":0}],["-7,8,-1",{"type":"shield","pos":[-7,8,-1],"conductivity":0.0001,"groupId":0}],["-6,8,-2",{"type":"shield","pos":[-6,8,-2],"conductivity":0.0001,"groupId":0}],["-5,8,-3",{"type":"shield","pos":[-5,8,-3],"conductivity":0.0001,"groupId":0}],["-4,8,-4",{"type":"shield","pos":[-4,8,-4],"conductivity":0.0001,"groupId":0}],["-3,8,-5",{"type":"shield","pos":[-3,8,-5],"conductivity":0.0001,"groupId":0}],["-2,8,-6",{"type":"shield","pos":[-2,8,-6],"conductivity":0.0001,"groupId":0}],["-1,8,-7",{"type":"shield","pos":[-1,8,-7],"conductivity":0.0001,"groupId":0}],["0,8,-8",{"type":"shield","pos":[0,8,-8],"conductivity":0.0001,"groupId":0}],["1,7,-8",{"type":"shield","pos":[1,7,-8],"conductivity":0.0001,"groupId":0}],["2,6,-8",{"type":"shield","pos":[2,6,-8],"conductivity":0.0001,"groupId":0}],["3,5,-8",{"type":"shield","pos":[3,5,-8],"conductivity":0.0001,"groupId":0}],["4,4,-8",{"type":"shield","pos":[4,4,-8],"conductivity":0.0001,"groupId":0}],["5,3,-8",{"type":"shield","pos":[5,3,-8],"conductivity":0.0001,"groupId":0}],["6,2,-8",{"type":"shield","pos":[6,2,-8],"conductivity":0.0001,"groupId":0}],["7,1,-8",{"type":"shield","pos":[7,1,-8],"conductivity":0.0001,"groupId":0}],["8,0,-8",{"type":"shield","pos":[8,0,-8],"conductivity":0.0001,"groupId":0}],["8,-1,-7",{"type":"shield","pos":[8,-1,-7],"conductivity":0.0001,"groupId":0}],["8,-2,-6",{"type":"shield","pos":[8,-2,-6],"conductivity":0.0001,"groupId":0}],["8,-3,-5",{"type":"shield","pos":[8,-3,-5],"conductivity":0.0001,"groupId":0}],["8,-4,-4",{"type":"shield","pos":[8,-4,-4],"conductivity":0.0001,"groupId":0}],["8,-5,-3",{"type":"shield","pos":[8,-5,-3],"conductivity":0.0001,"groupId":0}],["8,-6,-2",{"type":"shield","pos":[8,-6,-2],"conductivity":0.0001,"groupId":0}],["8,-7,-1",{"type":"shield","pos":[8,-7,-1],"conductivity":0.0001,"groupId":0}],["8,-8,0",{"type":"shield","pos":[8,-8,0],"conductivity":0.0001,"groupId":0}],["7,-8,1",{"type":"shield","pos":[7,-8,1],"conductivity":0.0001,"groupId":0}],["6,-8,2",{"type":"shield","pos":[6,-8,2],"conductivity":0.0001,"groupId":0}],["5,-8,3",{"type":"shield","pos":[5,-8,3],"conductivity":0.0001,"groupId":0}],["4,-8,4",{"type":"shield","pos":[4,-8,4],"conductivity":0.0001,"groupId":0}],["3,-8,5",{"type":"shield","pos":[3,-8,5],"conductivity":0.0001,"groupId":0}],["2,-8,6",{"type":"shield","pos":[2,-8,6],"conductivity":0.0001,"groupId":0}],["1,-8,7",{"type":"shield","pos":[1,-8,7],"conductivity":0.0001,"groupId":0}],["0,-8,8",{"type":"shield","pos":[0,-8,8],"conductivity":0.0001,"groupId":0}],["-1,-7,8",{"type":"shield","pos":[-1,-7,8],"conductivity":0.0001,"groupId":0}],["-2,-6,8",{"type":"shield","pos":[-2,-6,8],"conductivity":0.0001,"groupId":0}],["-3,-5,8",{"type":"shield","pos":[-3,-5,8],"conductivity":0.0001,"groupId":0}],["-4,-4,8",{"type":"shield","pos":[-4,-4,8],"conductivity":0.0001,"groupId":0}],["-5,-3,8",{"type":"shield","pos":[-5,-3,8],"conductivity":0.0001,"groupId":0}],["-6,-2,8",{"type":"shield","pos":[-6,-2,8],"conductivity":0.0001,"groupId":0}],["-7,-1,8",{"type":"shield","pos":[-7,-1,8],"conductivity":0.0001,"groupId":0}],["-8,0,8",{"type":"shield","pos":[-8,0,8],"conductivity":0.0001,"groupId":0}],["-8,1,7",{"type":"shield","pos":[-8,1,7],"conductivity":0.0001,"groupId":0}],["-8,2,6",{"type":"shield","pos":[-8,2,6],"conductivity":0.0001,"groupId":0}],["-8,3,5",{"type":"shield","pos":[-8,3,5],"conductivity":0.0001,"groupId":0}],["-8,4,4",{"type":"shield","pos":[-8,4,4],"conductivity":0.0001,"groupId":0}],["-8,5,3",{"type":"shield","pos":[-8,5,3],"conductivity":0.0001,"groupId":0}],["-8,6,2",{"type":"shield","pos":[-8,6,2],"conductivity":0.0001,"groupId":0}],["-8,7,1",{"type":"shield","pos":[-8,7,1],"conductivity":0.0001,"groupId":0}],["0,0,0",{"type":"source","pos":[0,0,0],"power":200,"active":true,"minActivation":0,"groupId":1}],["-6,0,6",{"type":"probe","pos":[-6,0,6],"groupId":0}],["-7,1,6",{"type":"sink","pos":[-7,1,6],"pullRate":0.1,"conductivity":0.8,"groupId":1}],["-7,0,7",{"type":"sink","pos":[-7,0,7],"pullRate":0.1,"conductivity":0.8,"groupId":2}],["-6,-1,7",{"type":"sink","pos":[-6,-1,7],"pullRate":0.1,"conductivity":0.8,"groupId":3}],["-1,-6,7",{"type":"sink","pos":[-1,-6,7],"pullRate":0.1,"conductivity":0.8,"groupId":1}],["0,-7,7",{"type":"sink","pos":[0,-7,7],"pullRate":0.1,"conductivity":0.8,"groupId":1}],["1,-7,6",{"type":"sink","pos":[1,-7,6],"pullRate":0.1,"conductivity":0.8,"groupId":1}],["6,-7,1",{"type":"sink","pos":[6,-7,1],"pullRate":0.1,"conductivity":0.8,"groupId":2}],["7,-7,0",{"type":"sink","pos":[7,-7,0],"pullRate":0.1,"conductivity":0.8,"groupId":2}],["7,-6,-1",{"type":"sink","pos":[7,-6,-1],"pullRate":0.1,"conductivity":0.8,"groupId":2}],["7,-1,-6",{"type":"sink","pos":[7,-1,-6],"pullRate":0.1,"conductivity":0.8,"groupId":3}],["7,0,-7",{"type":"sink","pos":[7,0,-7],"pullRate":0.1,"conductivity":0.8,"groupId":3}],["6,1,-7",{"type":"sink","pos":[6,1,-7],"pullRate":0.1,"conductivity":0.8,"groupId":3}],["6,0,-6",{"type":"probe","pos":[6,0,-6],"groupId":3}],["5,2,-7",{"type":"shield","pos":[5,2,-7],"conductivity":0.0001,"groupId":1}],["5,1,-6",{"type":"shield","pos":[5,1,-6],"conductivity":0.0001,"groupId":1}],["5,0,-5",{"type":"shield","pos":[5,0,-5],"conductivity":0.0001,"groupId":1}],["6,-1,-5",{"type":"shield","pos":[6,-1,-5],"conductivity":0.0001,"groupId":1}],["7,-2,-5",{"type":"shield","pos":[7,-2,-5],"conductivity":0.0001,"groupId":1}],["6,-6,0",{"type":"probe","pos":[6,-6,0],"groupId":2}],["0,-6,6",{"type":"probe","pos":[0,-6,6],"groupId":1}],["-7,2,5",{"type":"shield","pos":[-7,2,5],"conductivity":0.0001,"groupId":1}],["-6,1,5",{"type":"shield","pos":[-6,1,5],"conductivity":0.0001,"groupId":1}],["-5,0,5",{"type":"shield","pos":[-5,0,5],"conductivity":0.0001,"groupId":1}],["-5,-1,6",{"type":"shield","pos":[-5,-1,6],"conductivity":0.0001,"groupId":1}],["-5,-2,7",{"type":"shield","pos":[-5,-2,7],"conductivity":0.0001,"groupId":1}],["-2,-5,7",{"type":"shield","pos":[-2,-5,7],"conductivity":0.0001,"groupId":1}],["-1,-5,6",{"type":"shield","pos":[-1,-5,6],"conductivity":0.0001,"groupId":1}],["1,-6,5",{"type":"shield","pos":[1,-6,5],"conductivity":0.0001,"groupId":1}],["0,-5,5",{"type":"shield","pos":[0,-5,5],"conductivity":0.0001,"groupId":1}],["2,-7,5",{"type":"shield","pos":[2,-7,5],"conductivity":0.0001,"groupId":1}],["5,-7,2",{"type":"shield","pos":[5,-7,2],"conductivity":0.0001,"groupId":1}],["5,-6,1",{"type":"shield","pos":[5,-6,1],"conductivity":0.0001,"groupId":1}],["5,-5,0",{"type":"shield","pos":[5,-5,0],"conductivity":0.0001,"groupId":1}],["6,-5,-1",{"type":"shield","pos":[6,-5,-1],"conductivity":0.0001,"groupId":1}],["7,-5,-2",{"type":"shield","pos":[7,-5,-2],"conductivity":0.0001,"groupId":0}],["2,-1,-1",{"type":"shield","pos":[2,-1,-1],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-1,-1,2",{"type":"shield","pos":[-1,-1,2],"conductivity":0.0001,"groupId":1}],["1,-2,1",{"type":"shield","pos":[1,-2,1],"conductivity":0.0001,"groupId":1}],["2,-4,2",{"type":"probe","pos":[2,-4,2],"groupId":1}],["2,-5,3",{"type":"shield","pos":[2,-5,3],"conductivity":0.0001,"groupId":1}],["1,-4,3",{"type":"shield","pos":[1,-4,3],"conductivity":0.0001,"groupId":1}],["3,-5,2",{"type":"shield","pos":[3,-5,2],"conductivity":0.0001,"groupId":1}],["3,-4,1",{"type":"shield","pos":[3,-4,1],"conductivity":0.0001,"groupId":1}],["3,-3,0",{"type":"shield","pos":[3,-3,0],"conductivity":0.0001,"groupId":1}],["3,-2,-1",{"type":"shield","pos":[3,-2,-1],"conductivity":0.0001,"groupId":2}],["0,-3,3",{"type":"shield","pos":[0,-3,3],"conductivity":0.0001,"groupId":1}],["-1,-2,3",{"type":"shield","pos":[-1,-2,3],"conductivity":0.0001,"groupId":2}],["-3,-3,6",{"type":"sink","pos":[-3,-3,6],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["-4,-3,7",{"type":"sink","pos":[-4,-3,7],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["-3,-4,7",{"type":"sink","pos":[-3,-4,7],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["7,-3,-4",{"type":"sink","pos":[7,-3,-4],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["6,-3,-3",{"type":"sink","pos":[6,-3,-3],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["7,-4,-3",{"type":"sink","pos":[7,-4,-3],"pullRate":0.1,"conductivity":0.8,"groupId":6}],["-2,1,1",{"type":"shield","pos":[-2,1,1],"conductivity":0.0001,"groupId":1}],["-4,2,2",{"type":"probe","pos":[-4,2,2],"groupId":3}],["-5,2,3",{"type":"shield","pos":[-5,2,3],"conductivity":0.0001,"groupId":1}],["-5,3,2",{"type":"shield","pos":[-5,3,2],"conductivity":0.0001,"groupId":1}],["-4,3,1",{"type":"shield","pos":[-4,3,1],"conductivity":0.0001,"groupId":1}],["-4,1,3",{"type":"shield","pos":[-4,1,3],"conductivity":0.0001,"groupId":1}],["-3,0,3",{"type":"shield","pos":[-3,0,3],"conductivity":0.0001,"groupId":1}],["-2,-1,3",{"type":"shield","pos":[-2,-1,3],"conductivity":0.0001,"groupId":1}],["-3,3,0",{"type":"shield","pos":[-3,3,0],"conductivity":0.0001,"groupId":1}],["1,1,-2",{"type":"shield","pos":[1,1,-2],"conductivity":0.0001,"groupId":1}],["2,2,-4",{"type":"probe","pos":[2,2,-4],"groupId":2}],["2,3,-5",{"type":"shield","pos":[2,3,-5],"conductivity":0.0001,"groupId":1}],["3,2,-5",{"type":"shield","pos":[3,2,-5],"conductivity":0.0001,"groupId":1}],["3,1,-4",{"type":"shield","pos":[3,1,-4],"conductivity":0.0001,"groupId":1}],["3,0,-3",{"type":"shield","pos":[3,0,-3],"conductivity":0.0001,"groupId":1}],["3,-1,-2",{"type":"shield","pos":[3,-1,-2],"conductivity":0.0001,"groupId":1}],["1,3,-4",{"type":"shield","pos":[1,3,-4],"conductivity":0.0001,"groupId":1}],["0,3,-3",{"type":"shield","pos":[0,3,-3],"conductivity":0.0001,"groupId":1}],["-1,3,-2",{"type":"shield","pos":[-1,3,-2],"conductivity":0.0001,"groupId":1}],["-2,3,-1",{"type":"shield","pos":[-2,3,-1],"conductivity":0.0001,"groupId":2}],["-1,2,-1",{"type":"shield","pos":[-1,2,-1],"conductivity":0.0001,"groupId":1}],["-6,7,-1",{"type":"sink","pos":[-6,7,-1],"pullRate":0.1,"conductivity":0.8,"groupId":5,"heatTolerance":1400}],["-7,7,0",{"type":"sink","pos":[-7,7,0],"pullRate":0.1,"conductivity":0.8,"groupId":5,"heatTolerance":1400}],["-7,6,1",{"type":"sink","pos":[-7,6,1],"pullRate":0.1,"conductivity":0.8,"groupId":5,"heatTolerance":1400}],["-1,7,-6",{"type":"sink","pos":[-1,7,-6],"pullRate":0.1,"conductivity":0.8,"groupId":4,"heatTolerance":1400}],["0,7,-7",{"type":"sink","pos":[0,7,-7],"pullRate":0.1,"conductivity":0.8,"groupId":4,"heatTolerance":1400}],["1,6,-7",{"type":"sink","pos":[1,6,-7],"pullRate":0.1,"conductivity":0.8,"groupId":4,"heatTolerance":1400}],["2,5,-7",{"type":"shield","pos":[2,5,-7],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["1,5,-6",{"type":"shield","pos":[1,5,-6],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["0,5,-5",{"type":"shield","pos":[0,5,-5],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-1,6,-5",{"type":"shield","pos":[-1,6,-5],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-2,7,-5",{"type":"shield","pos":[-2,7,-5],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-5,7,-2",{"type":"shield","pos":[-5,7,-2],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-5,6,-1",{"type":"shield","pos":[-5,6,-1],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-5,5,0",{"type":"shield","pos":[-5,5,0],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-6,5,1",{"type":"shield","pos":[-6,5,1],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-7,5,2",{"type":"shield","pos":[-7,5,2],"conductivity":0.0001,"groupId":1,"heatTolerance":2000}],["-3,7,-4",{"type":"sink","pos":[-3,7,-4],"pullRate":0.1,"conductivity":0.8,"groupId":6,"heatTolerance":1400}],["-4,7,-3",{"type":"sink","pos":[-4,7,-3],"pullRate":0.1,"conductivity":0.8,"groupId":6,"heatTolerance":1400}],["-3,6,-3",{"type":"sink","pos":[-3,6,-3],"pullRate":0.1,"conductivity":0.8,"groupId":6,"heatTolerance":1400}],["0,6,-6",{"type":"probe","pos":[0,6,-6],"groupId":1,"heatTolerance":1800}],["-6,6,0",{"type":"probe","pos":[-6,6,0],"groupId":2,"heatTolerance":1800}]]'),Xt=[[1,{id:1,stored:1e4,capacity:1e4,drainRate:10,surchargeCost:2e3}],[2,{id:2,stored:1e3,capacity:1e3,drainRate:10,surchargeCost:2}],[3,{id:3,stored:1e3,capacity:1e3,drainRate:1,surchargeCost:500}],[4,{id:4,stored:0,capacity:1e3,drainRate:1,surchargeCost:500}]],Vt=[[1,{id:1,heat:61519.09672377093,volume:5e3,radiator:{deployed:!1,strength:50}}],[2,{id:2,heat:50678.78425748482,volume:5e3,radiator:{deployed:!1,strength:50}}],[3,{id:3,heat:16700.49955793047,volume:5e3,radiator:{deployed:!1,strength:50}}],[4,{id:4,heat:62170.88890538169,volume:5e3,radiator:{deployed:!1,strength:50}}],[5,{id:5,heat:51913.58234335027,volume:5e3,radiator:{deployed:!1,strength:50}}],[6,{id:6,heat:2897.709120308153,volume:5e3,radiator:{deployed:!1,strength:50}}]],Wt=[[1,.35],[2,1],[3,1],[4,1]],Jt=[[1,1],[2,1],[3,1],[4,1]],Qt=[],qt={entities:Yt,capacitors:Xt,reservoirs:Vt,groupThrottles:Wt,probeThrottles:Jt,disabledShieldGroups:Qt};function k(e){const t=document.getElementById(e);if(!t)throw new Error(`Missing element #${e}`);return t}function K(e,t){const o=document.getElementById(e);o&&(o.textContent=t)}function Zt(e){e.innerHTML=`
  <div id="reactor-layout" style="display:flex; width:100vw; height:100vh; overflow:hidden; margin:0; padding:0;">
    \x3C!-- LEFT SIDEBAR: GAMEPLAY -->
    <div id="reactor-sidebar-left" style="width:300px; background:#222; color:#eee; display:flex; flex-direction:column; align-items:flex-start; padding:10px; border-right:1px solid #444; z-index:10; box-sizing:border-box; overflow-y:auto;">
      <h2 style="margin-top:0;">Reactor Control</h2>

      <div class="panel-section" style="display:flex; gap:8px; flex-wrap:wrap;">
        <button id="btn-play-pause">Play</button>
        <button id="btn-step">Step</button>
        <button id="btn-step-5">+5</button>
        <button id="btn-quench" style="background:#44a; color:white;">Quench</button>
      </div>

      <div style="margin:10px 0; font-size: 0.9em; display:flex; flex-direction:column; gap:5px;">
        <div style="display:flex; justify-content:space-between;">
           <span>Tick: <span id="tick-count">0</span></span>
           <span style="color:#aaa;">Time: <span id="tick-time">0.00</span>ms</span>
        </div>
        
        <div style="border-top:1px solid #444; padding-top:5px; margin-top:5px;">
           <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
             <span style="color:#aaa;">Tick Budget</span>
             <span id="lbl-tick-budget" style="color:#fff;">100ms</span>
           </div>
           <input id="inp-tick-budget" type="range" min="0" max="1000" value="100" step="10" style="width:100%; cursor:pointer;">
        </div>
      </div>

       <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">SOURCE CONTROLS</div>
      <div id="source-controls" style="margin-bottom:10px; width:100%;"></div>

      <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">SHIELD CONTROLS</div>
      <div id="shield-controls" style="margin-bottom:10px; width:100%;"></div>

      <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">RESERVOIRS</div>
      <div id="reservoir-controls" style="margin-bottom:10px; width:100%;"></div>

      <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">CAPACITOR BANKS & PROBES</div>
      <div id="capacitor-controls" style="margin-bottom:10px; width:100%;"></div>
    </div>

    \x3C!-- MAIN VIEW -->
    <div id="reactor-main" style="flex:1; position:relative; background:#111; overflow:hidden;">
      <div id="game-board" style="position:absolute; top:0; left:0; width:100%; height:100%;"></div>
      
      \x3C!-- HUD -->
      <div style="position:absolute; top:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); padding:5px 15px; border-radius:15px; border:1px solid #444; color:#fff; font-family:monospace; pointer-events:none;">
        PERIMETER EXPOSURE: <span id="val-perimeter" style="font-weight:bold; color:#f88;">0.00</span>
      </div>

      \x3C!-- INSTRUCTIONS LEGEND -->
      <div style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.7); padding:10px; border-radius:8px; border:1px solid #444; color:#ccc; font-size:0.85em; font-family:sans-serif; pointer-events:none; max-width:280px; z-index:20;">
        <div style="font-weight:bold; color:#fff; margin-bottom:5px; border-bottom:1px solid #555; padding-bottom:3px;">Mechanics & Controls</div>
        <ul style="margin:0; padding-left:16px; list-style-type:square; line-height:1.4em;">
           <li><b>Source Throttle (Left):</b> Increases output.</li>
           <li><b>Probes:</b> Destroyed by direct source exposure (LOS).</li>
           <li><b>Grouping:</b> Hover entity + Press <b>1-6</b>.</li>
           <li><b>Shields:</b> Toggle via control buttons.</li>
        </ul>
      </div>
    </div>

    \x3C!-- RIGHT SIDEBAR: EDITOR -->
    <div id="reactor-sidebar-right" style="width:280px; background:#222; color:#eee; display:flex; flex-direction:column; align-items:flex-start; padding:10px; border-left:1px solid #444; z-index:10; box-sizing:border-box;">
      <h2 style="margin-top:0;">Construction</h2>

      <div class="panel-section" style="display:flex; gap:8px; margin-bottom:10px; width:100%;">
        <button id="btn-save" style="flex:1; background:#444;">Save</button>
        <button id="btn-load" style="flex:1; background:#444;">Load</button>
        <button id="btn-clear" style="flex:1; background:#622;">Clear</button>
      </div>

      <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">TOOLS</div>
      <div class="panel-section" id="palette-toolbar" style="display:flex; gap:5px; flex-wrap:wrap; margin-bottom:10px;"></div>

      <hr style="border-color:#444; width:100%;" />
      <div style="font-size:0.85em; color:#aaa; margin-bottom:5px;">ENTITY LIST</div>
      <div id="entity-list" style="flex:1; overflow-y:auto; font-size:14px; width:100%;"></div>
    </div>
  </div>
  `}function te(){const o=ht(8).map(p=>m(p)),s=new Bt(o),n=(window.innerWidth-580)/2,i=window.innerHeight/2,r={size:{x:30,y:30},origin:{x:n,y:i},orientation:"pointy"},l=k("game-board"),c=new _t(l,r);return{game:s,hexGrid:c,layout:r}}function ct(e){return e<50?"#aaf":e<150?"#fff":"#f88"}function dt(e,t,o){const s=Dt(e);t.render(s,{styleFn:Ft}),K("tick-count",String(e.state.tickCount)),K("tick-time",o.lastTickDuration.toFixed(2)),K("val-perimeter",e.state.lastPerimeterEnergy.toFixed(2)),oe(e,o,()=>dt(e,t,o));for(const i of[1,2,3,4]){const r=document.getElementById(`lbl-probe-total-${i}`);r&&(r.textContent=(e.state.totalEnergyCollected.get(i)??0).toFixed(1));const l=document.getElementById(`lbl-probe-rate-${i}`);if(l){const c=(e.state.lastTickEnergy.get(i)??0).toFixed(2);l.textContent=`+${c}/t`}}ce(e),de(e),le(e);for(const i of[1,2,3,4]){const r=document.getElementById(`lbl-probe-total-${i}`),l=e.state.capacitors.get(i);r&&l&&(r.textContent=l.stored.toFixed(0));const c=document.getElementById(`lbl-probe-rate-${i}`);if(c){const p=e.state.lastCapacitorDelta.get(i)??0,u=p>=0?"+":"";c.textContent=`${u}${p.toFixed(2)}/t`,c.style.color=p>0?"#8f8":p<0?"#f88":"#aaa"}}}function ee(e,t){const o=t?e.state.entities.get(t):void 0;return{selectedKey:t,entityType:o?o.type:"empty"}}function oe(e,t,o){const s=ee(e,t.selectedKey);s.selectedKey===t.lastSidebarSig.selectedKey&&s.entityType===t.lastSidebarSig.entityType||(se(e,t,o),t.lastSidebarSig=s),ie(e,t.selectedKey)}function se(e,t,o){const s=k("entity-list");if(s.innerHTML="",t.selectedKey){const n=e.state.entities.get(t.selectedKey),i=document.createElement("div");if(i.id="sidebar-detail-panel",i.style.background="#333",i.style.padding="10px",i.style.borderLeft=n?"4px solid #f88":"4px solid #555",i.style.marginBottom="15px",i.innerHTML=`
      <div style="font-size:1.1em; font-weight:bold;">
        ${n?n.type.toUpperCase():"EMPTY SPACE"}
      </div>
      <div style="font-family:monospace; color:#aaa; margin-bottom:5px;">${t.selectedKey}</div>
      <div style="margin-bottom:8px;">
        Temp: <strong id="val-temp" style="color:#fff">--</strong>
      </div>
    `,n){if(i.appendChild(document.createElement("hr")),n.type==="source"){const r=n;i.appendChild(R("Power",r.power,c=>r.power=c,1,"inp-power")),i.appendChild(R("Min Active",r.minActivation,c=>r.minActivation=c,1,"inp-minactive")),i.appendChild(R("Group ID",r.groupId??1,c=>{r.groupId=X(c,1,4)},1,"inp-group"));const l=document.createElement("button");l.id="btn-active-toggle",l.style.marginTop="5px",l.style.width="100%",l.onclick=()=>{r.active=!r.active},i.appendChild(l)}if(n.type==="sink"){const r=n;i.appendChild(R("Pull Rate",r.pullRate,c=>r.pullRate=Math.min(1,Math.max(0,c)),.01,"inp-pull")),i.appendChild(R("Conductivity",r.conductivity,c=>r.conductivity=c,.1,"inp-cond")),i.appendChild(R("Tolerance",r.heatTolerance??1400,c=>r.heatTolerance=c,100,"inp-tol")),i.appendChild(R("Group ID",r.groupId??1,c=>{r.groupId=X(c,1,6)},1,"inp-sink-group"));const l=e.state.reservoirs.get(r.groupId??1);if(l){const c=document.createElement("div");c.style.marginTop="5px",c.style.color="#aaa",c.textContent=`Feeds Reservoir ${l.id} (${(l.heat/l.volume).toFixed(0)}Â°)`,i.appendChild(c)}}if(n.type==="shield"){const r=n;i.appendChild(R("Conductivity",r.conductivity,l=>r.conductivity=l,.01,"inp-cond")),i.appendChild(R("Tolerance",r.heatTolerance??2e3,l=>r.heatTolerance=l,10,"inp-tol")),i.appendChild(R("Group ID",r.groupId??1,l=>{r.groupId=X(l,1,4)},1,"inp-shield-group"))}if(n.type==="probe"){const r=n;r.groupId===void 0&&(r.groupId=1),i.appendChild(R("Tolerance",r.heatTolerance??1800,c=>r.heatTolerance=c,100,"inp-tol")),i.appendChild(R("Group ID",r.groupId,c=>{r.groupId=X(c,1,4)},1,"inp-probe-group"));const l=document.createElement("div");l.style.color="#aaa",l.style.fontStyle="italic",l.style.marginTop="5px",l.textContent="Collects energy based on group delta E.",i.appendChild(l)}}else i.innerHTML+='<div style="color:#aaa; font-size:0.9em;">Select a tool to place a component.</div>';s.appendChild(i)}else{const n=document.createElement("div");n.style.padding="10px",n.style.color="#777",n.textContent="Select a cell to view details.",s.appendChild(n)}ne(e,t,s,o)}function ie(e,t){if(!t)return;const o=e.state.E.get(t)??0,s=e.state.entities.get(t),n=document.getElementById("val-temp");if(n&&(n.textContent=o.toFixed(5),n.style.color=ct(o)),!s)return;const i=(l,c)=>{const p=document.getElementById(l);p&&document.activeElement!==p&&(p.value=String(c))};if(s.type==="source"){const l=s;i("inp-power",l.power),i("inp-minactive",l.minActivation),i("inp-group",l.groupId??1);const c=document.getElementById("btn-active-toggle");c&&(c.textContent=l.active?"ACTIVE":"INACTIVE",c.style.background=l.active?"#2b2":"#b22")}if(s.type==="sink"){const l=s;i("inp-cond",l.conductivity),i("inp-pull",l.pullRate),i("inp-tol",l.heatTolerance??1400),i("inp-sink-group",l.groupId??1)}if(s.type==="shield"&&(i("inp-cond",s.conductivity),i("inp-tol",s.heatTolerance??2e3),i("inp-shield-group",s.groupId??1)),s.type==="probe"){const l=s;i("inp-tol",l.heatTolerance??1800),l.groupId===void 0&&(l.groupId=1),i("inp-probe-group",l.groupId)}const r=document.getElementById(`list-sum-${t}`);r&&(r.textContent=ft(s))}function ne(e,t,o,s){const n={source:[],sink:[],shield:[],probe:[]};for(const[r,l]of e.state.entities){const c=l.type;n[c]&&n[c].push({key:r,entity:l})}const i=(r,l)=>{if(l.length===0)return;const c=document.createElement("div");c.textContent=r.toUpperCase(),c.style.fontSize="0.85em",c.style.color="#888",c.style.marginTop="10px",c.style.borderBottom="1px solid #444",o.appendChild(c);for(const p of l){const u=document.createElement("div");u.style.padding="4px 8px",u.style.cursor="pointer",u.style.fontSize="0.9em",u.style.borderBottom="1px solid #333",p.key===t.selectedKey&&(u.style.background="#444"),u.onclick=()=>{t.selectedKey=p.key,s()},u.innerHTML=`
        <div style="display:flex; justify-content:space-between;">
          <span>${p.key}</span>
          <span id="list-sum-${p.key}" style="color:#aaa;">${ft(p.entity)}</span>
        </div>
      `,o.appendChild(u)}};i("Sources",n.source),i("Sinks",n.sink),i("Shields",n.shield),i("Probes",n.probe)}function ft(e){return e?e.type==="source"?`G${e.groupId} â€¢ Pwr: ${e.power}`:e.type==="sink"?`G${e.groupId} â€¢ Pull: ${e.pullRate}`:e.type==="shield"?`G${e.groupId} â€¢ Cond: ${e.conductivity}`:e.type==="probe"?`G${e.groupId}`:"":""}function X(e,t,o){return Math.max(t,Math.min(o,Math.round(e)))}function R(e,t,o,s=1,n){const i=document.createElement("div");i.style.marginTop="4px",i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center";const r=document.createElement("span");r.style.fontSize="0.9em",r.style.color="#ccc",r.textContent=e;const l=document.createElement("input");n&&(l.id=n),l.type="number",l.value=String(t),l.style.width="70px",l.style.background="#222",l.style.color="#fff",l.style.border="1px solid #555",l.style.padding="2px",l.step=String(s);const c=()=>{const p=parseFloat(l.value);Number.isFinite(p)&&o(p)};return l.addEventListener("change",c),l.addEventListener("input",c),i.appendChild(r),i.appendChild(l),i}function re(e){const t=k("palette-toolbar"),o=[{id:"select",label:"Select"},{id:"source",label:"Source",color:"#f88"},{id:"sink",label:"Sink",color:"#88f"},{id:"shield",label:"Shield",color:"#8f8"},{id:"probe",label:"Probe",color:"#ff8"},{id:"erase",label:"Erase",color:"#aaa"}],s=n=>{e.activeTool=n,document.querySelectorAll(".palette-btn").forEach(i=>{const r=i,l=r.dataset.tool===n;r.style.background=l?"#66a":"#333",r.style.borderColor=l?"#aaf":"#555"})};for(const n of o){const i=document.createElement("button");i.className="palette-btn",i.dataset.tool=n.id,i.textContent=n.label,i.style.flex="1 0 30%",i.style.padding="5px 0",i.style.cursor="pointer",i.style.border="1px solid #555",i.style.background="#333",i.style.color="#eee",n.color&&(i.style.borderLeft=`3px solid ${n.color}`),i.onclick=()=>s(n.id),t.appendChild(i)}s("select")}function J(e,t,o){const s=k("source-controls");s.innerHTML="",s.style.display="flex",s.style.flexDirection="column",s.style.gap="8px";for(const n of[1,2,3,4]){const i=document.createElement("div");i.style.background="#282828",i.style.padding="5px",i.style.border="1px solid #444";const r=e.state.groupThrottles.get(n)??0,l=Math.round(r*100),c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.marginBottom="2px",c.innerHTML=`
      <span style="font-size:0.9em; color:#aaa; font-weight:bold;">GROUP ${n}</span>
      <span id="lbl-grp-${n}" style="font-size:0.9em; color:#fff;">${l}%</span>
    `;const p=document.createElement("input");p.type="range",p.min="0",p.max="100",p.value=String(l),p.style.width="100%",p.style.cursor="pointer",p.style.marginBottom="5px",p.oninput=()=>{const y=parseInt(p.value,10);e.state.groupThrottles.set(n,y/100),K(`lbl-grp-${n}`,`${y}%`),t.isPlaying||o()};const u=document.createElement("div");u.id=`source-list-group-${n}`,u.style.fontSize="0.8em",u.style.color="#aaa",u.style.minHeight="10px",i.appendChild(c),i.appendChild(p),i.appendChild(u),s.appendChild(i)}}function le(e){const t=new Map;for(const o of e.state.entities.values())if(o.type==="source"){const s=o,n=s.groupId||1;t.has(n)||t.set(n,[]),t.get(n).push(s)}for(const o of[1,2,3,4]){const s=document.getElementById(`source-list-group-${o}`);if(!s)continue;const n=t.get(o)||[];if(n.length===0){s.innerHTML='<div style="padding:2px; font-style:italic; color:#555;">No sources</div>';continue}const i=new Map;s.querySelectorAll(".src-row").forEach(l=>{const c=l.getAttribute("data-key");c&&i.set(c,l)});const r=new Set;n.sort((l,c)=>m(l.pos).localeCompare(m(c.pos)));for(const l of n){const c=m(l.pos);r.add(c);const p=e.state.E.get(c)??0,u=e.state.lastDeltaE.get(c)??0,y=ct(p),v=l.active?"#ddd":"#777",I=l.active?"â—":"â—‹",b=u>=0?"+":"",g=u>.1?"#f88":u<-.1?"#aaf":"#666";let f=i.get(c);f||(f=document.createElement("div"),f.className="src-row",f.setAttribute("data-key",c),f.style.display="flex",f.style.justifyContent="space-between",f.style.alignItems="center",f.style.background="#00000030",f.style.padding="2px 4px",f.style.marginTop="1px",f.style.borderRadius="2px",s.appendChild(f)),f.innerHTML=`
                <span style="color:${v};" title="${l.active?"Active":"Inactive"}">${I} ${c}</span>
                <span style="color:#aaa;">P:${l.power}</span>
                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                    <span style="color:${y}; line-height:1em;">${p.toFixed(0)}Â°</span>
                    <span style="color:${g}; font-size:0.7em; line-height:1em;">${b}${u.toFixed(1)}/t</span>
                </div>
            `}for(const[l,c]of i)r.has(l)||c.remove()}}function Q(e,t){const o=k("shield-controls");o.innerHTML="",o.style.display="grid",o.style.gridTemplateColumns="repeat(4, 1fr)",o.style.gap="5px";for(const s of[1,2,3,4]){const n=document.createElement("button");n.textContent=`â›Š${s}`,n.style.padding="8px 0",n.style.cursor="pointer",n.style.fontWeight="bold";const i=()=>{const r=e.state.disabledShieldGroups.has(s);n.style.background=r?"#422":"#252",n.style.border=r?"1px solid #522":"1px solid #5a5",n.style.color=r?"#aaa":"#fff",n.style.opacity=r?"0.6":"1.0"};i(),n.onclick=()=>{e.toggleShieldGroup(s),i(),t()},o.appendChild(n)}}function q(e,t){const o=k("capacitor-controls");o.innerHTML="",o.style.display="flex",o.style.flexDirection="column",o.style.gap="8px";for(const s of[1,2,3,4]){const n=e.state.capacitors.get(s);if(!n)continue;const i=document.createElement("div");i.style.background="#222",i.style.padding="5px",i.style.border="1px solid #444",i.style.fontSize="0.85em";const r=e.state.probeThrottles.get(s)??0,l=Math.round(r*100),c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.marginBottom="4px",c.style.alignItems="center",c.innerHTML=`
      <div style="display:flex; flex-direction:column;">
        <span style="color:#aaa; font-weight:bold;">BANK ${s}</span>
        <span id="lbl-probe-val-${s}" style="color:#8f8; font-size:0.9em;">Probe: ${l}%</span>
      </div>
      <div style="text-align:right;">
         <span id="lbl-cap-val-${s}" style="color:#fff;">${n.stored.toFixed(0)} / ${n.capacity}</span>
      </div>
    `,i.appendChild(c);const p=document.createElement("input");p.type="range",p.min="0",p.max="100",p.value=String(l),p.style.width="100%",p.style.cursor="pointer",p.style.marginBottom="4px",p.oninput=()=>{const f=parseInt(p.value,10);e.state.probeThrottles.set(s,f/100);const x=document.getElementById(`lbl-probe-val-${s}`);x&&(x.textContent=`Probe: ${f}%`),E.isPlaying||t()},i.appendChild(p);const u={id:`prog-cap-${s}`,height:"6px",color:"#4d4"},y=document.createElement("div");y.style.width="100%",y.style.height=u.height,y.style.background="#000",y.style.marginTop="2px",y.style.marginBottom="4px",y.innerHTML=`<div id="${u.id}" style="width:0%; height:100%; background:${u.color}; transition: width 0.1s;"></div>`,i.appendChild(y);const v=document.createElement("div");v.style.display="flex",v.style.gap="4px",v.style.alignItems="center";const I=document.createElement("button");I.textContent="âš¡",I.title="Discharge (Surcharge)",I.style.width="24px",I.style.height="24px",I.style.padding="0",I.style.cursor="pointer",I.style.background="#d84",I.style.border="1px solid #a62",I.onclick=()=>{e.dischargeBank(s)?t():console.log("Not enough energy to discharge")},v.appendChild(I);const b=document.createElement("div");b.style.display="flex",b.style.justifyContent="space-between",b.style.fontSize="0.75em",b.style.color="#888",b.style.marginBottom="2px",b.innerHTML=`
      <span>Cap: <span id="lbl-probe-total-${s}" style="color:#ccc;">0</span></span>
      <span id="lbl-probe-rate-${s}" style="color:#ccc;">+0.00/t</span>
    `,i.appendChild(b);const g=(f,x,et)=>{const B=document.createElement("div");B.style.flex="1",B.innerHTML=`<div style="font-size:0.7em; color:#777;">${f}</div>`;const M=document.createElement("input");M.type="number",M.value=String(x),M.style.width="100%",M.style.background="#111",M.style.border="1px solid #333",M.style.color="#ccc",M.style.fontSize="0.8em",M.onchange=()=>{const j=e.state.capacitors.get(s);j&&(et(j,parseFloat(M.value)),t())},B.appendChild(M),v.appendChild(B)};g("Max",n.capacity,(f,x)=>f.capacity=x),g("Drain",n.drainRate,(f,x)=>f.drainRate=x),g("Cost",n.surchargeCost,(f,x)=>f.surchargeCost=x),i.appendChild(v),o.appendChild(i)}}function ce(e){for(const[t,o]of e.state.capacitors){const s=document.getElementById(`prog-cap-${t}`),n=document.getElementById(`lbl-cap-val-${t}`);if(s&&n){const i=Math.min(100,o.stored/o.capacity*100);s.style.width=`${i}%`,o.stored>=o.capacity?s.style.backgroundColor="#f44":s.style.backgroundColor="#4d4",n.textContent=`${o.stored.toFixed(0)} / ${o.capacity}`}}}function Z(e,t){const o=k("reservoir-controls");o.innerHTML="",o.style.display="grid",o.style.gridTemplateColumns="1fr 1fr 1fr",o.style.gap="5px";for(const[s]of e.state.reservoirs){const n=e.state.reservoirs.get(s),i=document.createElement("div");i.className="reservoir-card",i.setAttribute("data-id",String(s)),i.style.background="#222",i.style.border="1px solid #444",i.style.padding="4px",i.style.fontSize="0.8em";const r=document.createElement("div");r.style.fontWeight="bold",r.style.color="#aaa",r.textContent=`RES ${s}`,i.appendChild(r);const l=document.createElement("div");l.id=`res-temp-${s}`,l.style.color="#fff",l.style.marginBottom="2px",l.textContent="0Â°",i.appendChild(l);const c=document.createElement("div");c.style.display="flex",c.style.gap="2px",c.style.marginBottom="2px";const p=(y,v,I)=>{const b=document.createElement("div");b.style.flex="1",b.innerHTML=`<div style="font-size:0.6em; color:#777;">${y}</div>`;const g=document.createElement("input");g.type="number",g.value=String(v),g.style.width="100%",g.style.background="#111",g.style.border="1px solid #333",g.style.color="#ccc",g.style.fontSize="0.85em",g.onchange=()=>{const f=parseFloat(g.value);if(!isNaN(f)){const x=e.state.reservoirs.get(s);x&&(I(x,f),t())}},b.appendChild(g),c.appendChild(b)};p("Vol",n.volume,(y,v)=>y.volume=Math.max(1,v)),p("RadStr",n.radiator.strength,(y,v)=>y.radiator.strength=Math.max(0,v)),i.appendChild(c);const u=document.createElement("button");u.id=`btn-rad-${s}`,u.textContent="RAD",u.style.width="100%",u.style.fontSize="0.7em",u.style.padding="2px",u.style.cursor="pointer",u.onclick=()=>{const y=e.state.reservoirs.get(s);y&&(y.radiator.deployed=!y.radiator.deployed,t())},i.appendChild(u),o.appendChild(i)}}function de(e){for(const[t,o]of e.state.reservoirs){const s=document.getElementById(`res-temp-${t}`);if(s){const i=o.heat/o.volume;s.textContent=`${i.toFixed(0)}Â°`,s.style.color=ct(i)}const n=document.getElementById(`btn-rad-${t}`);n&&(n.style.background=o.radiator.deployed?"#aaf":"#333",n.style.color=o.radiator.deployed?"#000":"#888",n.style.border=o.radiator.deployed?"1px solid #fff":"1px solid #555")}}function ae(e,t,o,s){const n=i=>{o.activeTool==="select"?o.selectedKey=i:o.activeTool==="erase"?(e.setEntity(i,"empty"),o.selectedKey===i&&(o.selectedKey=null)):e.setEntity(i,o.activeTool),s()};t.onCellMouseDown=i=>{o.isPointerDown=!0,n(m(i))},t.onCellMouseEnter=i=>{o.isPointerDown&&n(m(i))},t.onCellHover=i=>{o.hoveredKey=m(i)},t.onCellClick=i=>{n(m(i))},t.onCellRightClick=i=>{console.log("Right click at",i)},window.addEventListener("mouseup",()=>o.isPointerDown=!1),window.addEventListener("mouseleave",()=>o.isPointerDown=!1)}function pe(e,t,o,s,n){k("btn-play-pause").onclick=()=>{t.isPlaying=!t.isPlaying,t.isPlaying?(k("btn-play-pause").textContent="Pause",s()):(k("btn-play-pause").textContent="Play",n(),o())},k("btn-step").onclick=()=>{e.tick(),o()},k("btn-step-5").onclick=()=>{for(let r=0;r<5;r++)e.tick();o()},k("btn-quench").onclick=()=>{for(const r of e.state.E.keys())e.state.E.set(r,0);for(const r of e.state.reservoirs.values())r.heat=0;o(),console.log("Reactor Quenched")};const i=k("inp-tick-budget");i.oninput=()=>{const r=parseInt(i.value,10);t.tickBudgetMs=r,K("lbl-tick-budget",`${r}ms`)},k("btn-save").onclick=async()=>{const r=e.serialize();try{if(window.showSaveFilePicker){const c=await(await window.showSaveFilePicker({suggestedName:"reactor_layout.json",types:[{description:"JSON File",accept:{"application/json":[".json"]}}]})).createWritable();await c.write(r),await c.close()}else{const l=new Blob([r],{type:"application/json"}),c=URL.createObjectURL(l),p=document.createElement("a");p.href=c,p.download="reactor_layout.json",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c)}console.log("Layout exported")}catch(l){console.error("Save cancelled or failed",l)}},k("btn-load").onclick=()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.style.display="none",document.body.appendChild(r),r.onchange=l=>{const c=l.target.files?.[0];if(!c)return;const p=new FileReader;p.onload=u=>{const y=u.target?.result;y&&(e.deserialize(y),J(e,t,o),Q(e,o),Z(e,o),q(e,o),o(),console.log("Layout loaded from file"))},p.readAsText(c),document.body.removeChild(r)},r.click()},k("btn-clear").onclick=r=>{r.preventDefault(),console.log("Btn Clear Clicked"),console.log("Clearing layout..."),e.clear(),k("source-controls").innerHTML="",k("shield-controls").innerHTML="",k("reservoir-controls").innerHTML="",k("capacitor-controls").innerHTML="",J(e,t,o),Q(e,o),Z(e,o),q(e,o),o(),console.log("Clear complete")}}function ue(e,t,o){window.addEventListener("keydown",s=>{if(["0","1","2","3","4","5","6","7","8","9"].includes(s.key)){const n=parseInt(s.key,10);if(t.hoveredKey){const i=e.state.entities.get(t.hoveredKey);i&&(i.type==="source"||i.type==="shield"||i.type==="probe"||i.type==="sink")&&(i.groupId=n,o())}}})}const ye=k("app");Zt(ye);const{game:L,hexGrid:tt,layout:rt}=te(),E={isPlaying:!1,rafId:null,activeTool:"select",selectedKey:null,isPointerDown:!1,hoveredKey:null,lastSidebarSig:{selectedKey:null,entityType:"empty"},tickBudgetMs:100,lastTickTime:0,lastTickDuration:0},$=()=>dt(L,tt,E);re(E);J(L,E,$);Q(L,$);Z(L,$);q(L,$);ae(L,tt,E,$);pe(L,E,$,he,fe);ue(L,E,$);function gt(e){if(!E.isPlaying)return;if(e-E.lastTickTime>=E.tickBudgetMs){const o=performance.now();L.tick();const s=performance.now();E.lastTickDuration=s-o,E.lastTickTime=e}dt(L,tt,E),E.rafId=requestAnimationFrame(gt)}function he(){E.rafId&&cancelAnimationFrame(E.rafId),E.rafId=requestAnimationFrame(gt)}function fe(){E.rafId&&cancelAnimationFrame(E.rafId),E.rafId=null}L.deserialize(JSON.stringify(qt));J(L,E,$);Q(L,$);Z(L,$);q(L,$);$();window.addEventListener("resize",()=>{const e=(window.innerWidth-580)/2,t=window.innerHeight/2;rt.origin.x=e,rt.origin.y=t,tt.updateLayout(rt),$()});</script>
    <style rel="stylesheet" crossorigin>:root{--hex-size: 30px;--hex-width: calc(var(--hex-size) * 1.732);--hex-height: calc(var(--hex-size) * 2);--bg-color: #1e1e2e;--hex-bg: #45475a;--hex-hover: #585b70;--hex-revealed: #313244;--text-color: #cdd6f4;--mine-color: #f38ba8;--flag-color: #f9e2af}body{margin:0;display:flex;place-items:center;min-width:320px;min-height:100vh;background-color:var(--bg-color);color:var(--text-color);font-family:Inter,sans-serif;overflow:hidden}#app{position:relative;width:100%;height:100vh;display:flex;justify-content:center;align-items:center}#game-board{position:relative}.hex{width:var(--hex-width);height:var(--hex-height);clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);background-color:#000;position:absolute;display:flex;justify-content:center;align-items:center;cursor:pointer;transition:transform .1s;transform:translate(-50%,-50%) scale(1);-webkit-user-select:none;user-select:none}.hex-inner{width:98%;height:98%;clip-path:inherit;background-color:var(--hex-bg);display:flex;justify-content:center;align-items:center;font-weight:700;font-size:14px;color:var(--text-color);transition:background-color .2s}.hex:hover{transform:translate(-50%,-50%) scale(1.15);z-index:10}.hex:hover .hex-inner{background-color:var(--hex-hover)}.hex.revealed{background-color:var(--hex-revealed);cursor:default}.hex.mine{background-color:var(--mine-color)}.hex.flagged:after{content:"ðŸš©";font-size:16px}.probe-cell-destroyed{opacity:.6;filter:grayscale(100%)}.disabled-shield-cell{opacity:.3;border:1px dashed #555;color:#777}.shield-cell-destroyed{background-color:#311;opacity:.8;border:2px solid #522;color:#a55;filter:sepia(.5)}.sink-cell-destroyed{background-color:#222;opacity:.8;border:2px solid #822;color:#e55}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
